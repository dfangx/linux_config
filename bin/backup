#!/bin/bash

export HOME="/home/$(id -un 1000)"

backup_dir="$HOME/documents $HOME/pictures"
excludes="--exclude=$HOME/documents/kvm --exclude=$HOME/documents/backup"

os="$(grep '^ID' /etc/os-release | cut -d '=' -f2 | gr -d '"')"
[ -f "/usr/lib/os-release" ] && os="$(grep '^ID' /usr/lib/os-release | cut -f2 -d '=' | tr -d '"')"

date=$(date +%F)
output="$HOME/documents/backup/$os-backup-$date.tgz"

tool="tar"
options="-cvpzf"

id=4

sudo -u "#1000" DISPLAY=":1" DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/1000/bus" dunstify -a "System Backup" "System is being backed up into ~/documents/backup/$os-backup-$date.tgz" -u normal -r "$id"
$tool $excludes $options $output $backup_dir
