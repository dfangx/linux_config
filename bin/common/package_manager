#!/bin/bash

if [ -f "/usr/lib/os-release" ]
then
    os="$(cat /usr/lib/os-release | grep "^ID" | cut -d "=" -f2)"
else
    os="$(cat /etc/os-release | grep "^ID" | cut -d "=" -f2)"
fi
action=$1

if [ -z "$action" ]
then
    echo "No commmand given. Aborting"
    exit 1
fi
shift
case "$action" in
    "install")
        pkgname=$@

        if [ -z "$pkgname" ]
        then
            echo "Package name must be provided to install package"
            exit 1
        fi

        case "$os" in
            "gentoo")
                sudo emerge -a "$pkgname"
                ;;
            "arch" | "artix")
                for pkg in ${pkgname[@]}
                do
                    sudo pacman -S "$pkg"
                done
                ;;
            "void")
                for pkg in ${pkgname[@]}
                do
                    sudo xbps-install pkg
                done
                ;;
            *)
        esac
        ;;
    "clean")
        case "$os" in
            "gentoo")
                sudo emerge -ca
                ;;
            "arch" | "artix")
                sudo pacman -Rns $(pacman -Qtdq)
                ;;
            *)
        esac
        ;;
    "remove")
        pkgname=$@

        if [ -z "$pkgname" ]
        then
            echo "Package name must be provided to remote package"
            exit 1
        fi

        case "$os" in
            "gentoo")
                sudo emerge -Cav "$pkgname"
                ;;
            "arch" | "artix")
                sudo pacman -Rns "$pkgname"
                ;;
            "void")
                sudo xbps-remove -R "$pkgname"
                ;;
            *)
        esac
        ;;
    "update")
        case "$os" in
            "gentoo")
                sudo emerge -quaDU --keep-going --with-bdeps=y @world
                ;;
            "arch" | "artix")
                sudo pacman -Syu && aurupdate
                ;;
            *)
        esac
        ;;
    *)
        ;;
esac
exec pkill -RTMIN+4 i3blocks
